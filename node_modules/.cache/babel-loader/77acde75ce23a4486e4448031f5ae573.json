{"ast":null,"code":"/**\n * TrueTypeFont.ts class for EJ2-PDF\n */\nimport { ByteArray } from './../../graphics/images/index';\nimport { TtfReader } from './ttf-reader';\nimport { PdfDictionary, SaveDescendantFontEventHandler, SaveFontDictionaryEventHandler } from './../../primitives/pdf-dictionary';\nimport { SaveFontProgramEventHandler, SaveCmapEventHandler } from './../../primitives/pdf-stream';\nimport { PdfStream } from './../../primitives/pdf-stream';\nimport { PdfArray } from './../../primitives/pdf-array';\nimport { PdfName } from './../../primitives/pdf-name';\nimport { PdfNumber } from './../../primitives/pdf-number';\nimport { PdfString } from './../../primitives/pdf-string';\nimport { PdfReferenceHolder } from './../../primitives/pdf-reference';\nimport { PdfFontMetrics } from './pdf-font-metrics';\nimport { StandardWidthTable } from './pdf-font-metrics';\nimport { DictionaryProperties } from './../../input-output/pdf-dictionary-properties';\nimport { Dictionary } from './../../collections/dictionary';\nimport { FontDescriptorFlags } from './enum';\nimport { RectangleF } from './../../drawing/pdf-drawing';\nimport { Operators } from './../../input-output/pdf-operators';\n\nvar UnicodeTrueTypeFont =\n/** @class */\nfunction () {\n  /* tslint:enable */\n  //Constructors\n\n  /**\n   * Initializes a new instance of the `PdfTrueTypeFont` class.\n   * @private\n   */\n  function UnicodeTrueTypeFont(base64String, size) {\n    // Fields\n    this.nameString = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\n    /**\n     * Specifies the Internal variable to store fields of `PdfDictionaryProperties`.\n     * @private\n     */\n\n    this.dictionaryProperties = new DictionaryProperties();\n    /**\n     * Indicates whether the font program is compressed or not.\n     * @private\n     */\n\n    this.isCompress = false;\n    /**\n     * Indicates whether the font is embedded or not.\n     */\n\n    this.isEmbedFont = false;\n    /**\n     * Cmap table's start prefix.\n     */\n\n    /* tslint:disable */\n\n    this.cmapPrefix = '/CIDInit /ProcSet findresource begin\\n12 dict begin\\nbegincmap' + Operators.newLine + '/CIDSystemInfo << /Registry (Adobe)/Ordering (UCS)/Supplement 0>> def\\n/CMapName ' + '/Adobe-Identity-UCS def\\n/CMapType 2 def\\n1 begincodespacerange' + Operators.newLine;\n    /* tslint:enable */\n\n    /**\n     * Cmap table's start suffix.\n     */\n\n    this.cmapEndCodespaceRange = 'endcodespacerange' + Operators.newLine;\n    /**\n     * Cmap's begin range marker.\n     */\n\n    this.cmapBeginRange = 'beginbfrange' + Operators.newLine;\n    /**\n     * Cmap's end range marker.\n     */\n\n    this.cmapEndRange = 'endbfrange' + Operators.newLine;\n    /**\n     * Cmap table's end\n     */\n\n    /* tslint:disable */\n\n    this.cmapSuffix = 'endbfrange\\nendcmap\\nCMapName currentdict ' + '/CMap defineresource pop\\nend end' + Operators.newLine;\n\n    if (base64String === null || base64String === undefined) {\n      throw new Error('ArgumentNullException:base64String');\n    }\n\n    this.fontSize = size;\n    this.fontString = base64String;\n    this.Initialize();\n  } //Implementation\n\n  /**\n   * Returns width of the char symbol.\n   */\n\n\n  UnicodeTrueTypeFont.prototype.getCharWidth = function (charCode) {\n    var codeWidth = this.ttfReader.getCharWidth(charCode);\n    return codeWidth;\n  };\n  /**\n   * Returns width of the text line.\n   */\n\n\n  UnicodeTrueTypeFont.prototype.getLineWidth = function (line) {\n    // if (line == null) {\n    //     throw new Error('ArgumentNullException : line');\n    // }\n    var width = 0;\n\n    for (var i = 0, len = line.length; i < len; i++) {\n      var ch = line[i];\n      var charWidth = this.getCharWidth(ch);\n      width += charWidth;\n    }\n\n    return width;\n  };\n  /**\n   * Initializes a new instance of the `PdfTrueTypeFont` class.\n   * @private\n   */\n\n\n  UnicodeTrueTypeFont.prototype.Initialize = function () {\n    var byteArray = new ByteArray(this.fontString.length);\n    byteArray.writeFromBase64String(this.fontString);\n    this.fontData = byteArray.internalBuffer;\n    this.ttfReader = new TtfReader(this.fontData);\n    this.ttfMetrics = this.ttfReader.metrics;\n  };\n\n  UnicodeTrueTypeFont.prototype.createInternals = function () {\n    this.fontDictionary = new PdfDictionary();\n    this.fontProgram = new PdfStream();\n    this.cmap = new PdfStream();\n    this.descendantFont = new PdfDictionary();\n    this.metrics = new PdfFontMetrics();\n    this.ttfReader.createInternals();\n    this.ttfMetrics = this.ttfReader.metrics;\n    this.initializeMetrics(); // Create all the dictionaries of the font.\n\n    this.subsetName = this.getFontName();\n    this.createDescendantFont();\n    this.createCmap();\n    this.createFontDictionary();\n    this.createFontProgram();\n  };\n\n  UnicodeTrueTypeFont.prototype.getInternals = function () {\n    return this.fontDictionary;\n  };\n  /**\n   * Initializes metrics.\n   */\n\n\n  UnicodeTrueTypeFont.prototype.initializeMetrics = function () {\n    var ttfMetrics = this.ttfReader.metrics;\n    this.metrics.ascent = ttfMetrics.macAscent;\n    this.metrics.descent = ttfMetrics.macDescent;\n    this.metrics.height = ttfMetrics.macAscent - ttfMetrics.macDescent + ttfMetrics.lineGap;\n    this.metrics.name = ttfMetrics.fontFamily;\n    this.metrics.postScriptName = ttfMetrics.postScriptName;\n    this.metrics.size = this.fontSize;\n    this.metrics.widthTable = new StandardWidthTable(ttfMetrics.widthTable);\n    this.metrics.lineGap = ttfMetrics.lineGap;\n    this.metrics.subScriptSizeFactor = ttfMetrics.subScriptSizeFactor;\n    this.metrics.superscriptSizeFactor = ttfMetrics.superscriptSizeFactor;\n    this.metrics.isBold = ttfMetrics.isBold;\n  };\n  /**\n   * Gets random string.\n   */\n\n\n  UnicodeTrueTypeFont.prototype.getFontName = function () {\n    var builder = '';\n    var name; // if (this.isEmbed === false) {\n\n    for (var i = 0; i < 6; i++) {\n      var index = Math.floor(Math.random() * (25 - 0 + 1)) + 0;\n      builder += this.nameString[index];\n    }\n\n    builder += '+'; // }\n\n    builder += this.ttfReader.metrics.postScriptName;\n    name = builder.toString(); // if (name === '') {\n    //     name = this.ttfReader.metrics.fontFamily;\n    // }\n\n    name = this.formatName(name);\n    return name;\n  };\n  /**\n   * Generates name of the font.\n   */\n\n\n  UnicodeTrueTypeFont.prototype.formatName = function (fontName) {\n    // if (fontName === null) {\n    //     throw new Error('ArgumentNullException : fontName');\n    // }\n    // if (fontName === '') {\n    //     throw new Error('ArgumentOutOfRangeException : fontName, Parameter can not be empty');\n    // }\n    var ret = fontName.replace('(', '#28');\n    ret = ret.replace(')', '#29');\n    ret = ret.replace('[', '#5B');\n    ret = ret.replace(']', '#5D');\n    ret = ret.replace('<', '#3C');\n    ret = ret.replace('>', '#3E');\n    ret = ret.replace('{', '#7B');\n    ret = ret.replace('}', '#7D');\n    ret = ret.replace('/', '#2F');\n    ret = ret.replace('%', '#25');\n    return ret.replace(' ', '#20');\n  };\n  /**\n   * Creates descendant font.\n   */\n\n\n  UnicodeTrueTypeFont.prototype.createDescendantFont = function () {\n    // Set property used to clone Font every time\n    this.descendantFont.isFont = true;\n    this.descendantFont.descendantFontBeginSave = new SaveDescendantFontEventHandler(this);\n    this.descendantFont.items.setValue(this.dictionaryProperties.type, new PdfName(this.dictionaryProperties.font));\n    this.descendantFont.items.setValue(this.dictionaryProperties.subtype, new PdfName(this.dictionaryProperties.cIDFontType2));\n    this.descendantFont.items.setValue(this.dictionaryProperties.baseFont, new PdfName(this.subsetName));\n    this.descendantFont.items.setValue(this.dictionaryProperties.cIDToGIDMap, new PdfName(this.dictionaryProperties.identity));\n    this.descendantFont.items.setValue(this.dictionaryProperties.dw, new PdfNumber(1000));\n    this.fontDescriptor = this.createFontDescriptor();\n    this.descendantFont.items.setValue(this.dictionaryProperties.fontDescriptor, new PdfReferenceHolder(this.fontDescriptor));\n    var systemInfo = this.createSystemInfo();\n    this.descendantFont.items.setValue(this.dictionaryProperties.cIDSystemInfo, systemInfo);\n  };\n  /**\n   * Creates font descriptor.\n   */\n\n\n  UnicodeTrueTypeFont.prototype.createFontDescriptor = function () {\n    var descriptor = new PdfDictionary();\n    var metrics = this.ttfReader.metrics; // Set property used to clone Font every time\n\n    descriptor.isFont = true;\n    descriptor.items.setValue(this.dictionaryProperties.type, new PdfName(this.dictionaryProperties.fontDescriptor));\n    descriptor.items.setValue(this.dictionaryProperties.fontName, new PdfName(this.subsetName));\n    descriptor.items.setValue(this.dictionaryProperties.flags, new PdfNumber(this.getDescriptorFlags()));\n    descriptor.items.setValue(this.dictionaryProperties.fontBBox, PdfArray.fromRectangle(this.getBoundBox()));\n    descriptor.items.setValue(this.dictionaryProperties.missingWidth, new PdfNumber(metrics.widthTable[32]));\n    descriptor.items.setValue(this.dictionaryProperties.stemV, new PdfNumber(metrics.stemV));\n    descriptor.items.setValue(this.dictionaryProperties.italicAngle, new PdfNumber(metrics.italicAngle));\n    descriptor.items.setValue(this.dictionaryProperties.capHeight, new PdfNumber(metrics.capHeight));\n    descriptor.items.setValue(this.dictionaryProperties.ascent, new PdfNumber(metrics.winAscent));\n    descriptor.items.setValue(this.dictionaryProperties.descent, new PdfNumber(metrics.winDescent));\n    descriptor.items.setValue(this.dictionaryProperties.leading, new PdfNumber(metrics.leading));\n    descriptor.items.setValue(this.dictionaryProperties.avgWidth, new PdfNumber(metrics.widthTable[32]));\n    descriptor.items.setValue(this.dictionaryProperties.fontFile2, new PdfReferenceHolder(this.fontProgram));\n    descriptor.items.setValue(this.dictionaryProperties.maxWidth, new PdfNumber(metrics.widthTable[32]));\n    descriptor.items.setValue(this.dictionaryProperties.xHeight, new PdfNumber(0));\n    descriptor.items.setValue(this.dictionaryProperties.stemH, new PdfNumber(0));\n    return descriptor;\n  };\n  /**\n   * Generates cmap.\n   * @private\n   */\n\n\n  UnicodeTrueTypeFont.prototype.createCmap = function () {\n    this.cmap.cmapBeginSave = new SaveCmapEventHandler(this);\n  };\n  /**\n   * Generates font dictionary.\n   */\n\n\n  UnicodeTrueTypeFont.prototype.createFontDictionary = function () {\n    // Set property used to clone Font every time\n    this.fontDictionary.isFont = true;\n    this.fontDictionary.fontDictionaryBeginSave = new SaveFontDictionaryEventHandler(this);\n    this.fontDictionary.items.setValue(this.dictionaryProperties.type, new PdfName(this.dictionaryProperties.font));\n    this.fontDictionary.items.setValue(this.dictionaryProperties.baseFont, new PdfName(this.subsetName));\n    this.fontDictionary.items.setValue(this.dictionaryProperties.subtype, new PdfName(this.dictionaryProperties.type0));\n    this.fontDictionary.items.setValue(this.dictionaryProperties.encoding, new PdfName(this.dictionaryProperties.identityH));\n    var descFonts = new PdfArray();\n    var reference = new PdfReferenceHolder(this.descendantFont); // Set property used to clone Font every time\n\n    descFonts.isFont = true;\n    descFonts.add(reference);\n    this.fontDictionary.items.setValue(this.dictionaryProperties.descendantFonts, descFonts);\n  };\n  /**\n   * Creates font program.\n   */\n\n\n  UnicodeTrueTypeFont.prototype.createFontProgram = function () {\n    this.fontProgram.fontProgramBeginSave = new SaveFontProgramEventHandler(this);\n  };\n  /**\n   * Creates system info dictionary for CID font.\n   * @private\n   */\n\n\n  UnicodeTrueTypeFont.prototype.createSystemInfo = function () {\n    var systemInfo = new PdfDictionary();\n    systemInfo.items.setValue(this.dictionaryProperties.registry, new PdfString('Adobe'));\n    systemInfo.items.setValue(this.dictionaryProperties.ordering, new PdfString(this.dictionaryProperties.identity));\n    systemInfo.items.setValue(this.dictionaryProperties.supplement, new PdfNumber(0));\n    return systemInfo;\n  };\n  /**\n   * Runs before font Dictionary will be saved.\n   */\n\n\n  UnicodeTrueTypeFont.prototype.descendantFontBeginSave = function () {\n    if (this.usedChars !== null && this.usedChars !== undefined && this.usedChars.size() > 0) {\n      var width = this.getDescendantWidth();\n\n      if (width !== null) {\n        this.descendantFont.items.setValue(this.dictionaryProperties.w, width);\n      }\n    }\n  };\n  /**\n   * Runs before font Dictionary will be saved.\n   */\n\n\n  UnicodeTrueTypeFont.prototype.cmapBeginSave = function () {\n    this.generateCmap();\n  };\n  /**\n   * Runs before font Dictionary will be saved.\n   */\n\n  /* tslint:disable */\n\n\n  UnicodeTrueTypeFont.prototype.fontDictionaryBeginSave = function () {\n    if (this.usedChars !== null && this.usedChars !== undefined && this.usedChars.size() > 0 && !this.fontDictionary.containsKey(this.dictionaryProperties.toUnicode)) {\n      this.fontDictionary.items.setValue(this.dictionaryProperties.toUnicode, new PdfReferenceHolder(this.cmap));\n    }\n  };\n  /* tslint:enable */\n\n  /**\n   * Runs before font program stream save.\n   */\n\n\n  UnicodeTrueTypeFont.prototype.fontProgramBeginSave = function () {\n    this.isCompress = true;\n    this.generateFontProgram();\n  };\n  /**\n   * Gets width description pad array for c i d font.\n   */\n\n\n  UnicodeTrueTypeFont.prototype.getDescendantWidth = function () {\n    var array = new PdfArray();\n\n    if (this.usedChars !== null && this.usedChars !== undefined && this.usedChars.size() > 0) {\n      var glyphInfo = []; // if (!this.isEmbedFont) {\n\n      var keys = this.usedChars.keys();\n\n      for (var i = 0; i < keys.length; i++) {\n        var chLen = keys[i];\n        var glyph = this.ttfReader.getGlyph(chLen);\n\n        if (glyph.empty) {\n          continue;\n        }\n\n        glyphInfo.push(glyph);\n      } // } else {\n      //     glyphInfo = this.ttfReader.getAllGlyphs();\n      // }\n\n\n      glyphInfo.sort(function (a, b) {\n        return a.index - b.index;\n      });\n      var firstGlyphIndex = 0;\n      var lastGlyphIndex = 0;\n      var firstGlyphIndexWasSet = false;\n      var widthDetails = new PdfArray(); // if (!this.isEmbedFont) {\n\n      for (var i = 0; i < glyphInfo.length; i++) {\n        var glyph = glyphInfo[i];\n\n        if (!firstGlyphIndexWasSet) {\n          firstGlyphIndexWasSet = true;\n          firstGlyphIndex = glyph.index;\n          lastGlyphIndex = glyph.index - 1;\n        }\n\n        if ((lastGlyphIndex + 1 !== glyph.index || i + 1 === glyphInfo.length) && glyphInfo.length > 1) {\n          // Add glyph index / width.\n          array.add(new PdfNumber(firstGlyphIndex));\n\n          if (i !== 0) {\n            array.add(widthDetails);\n          }\n\n          firstGlyphIndex = glyph.index;\n          widthDetails = new PdfArray();\n        }\n\n        widthDetails.add(new PdfNumber(glyph.width));\n\n        if (i + 1 === glyphInfo.length) {\n          array.add(new PdfNumber(firstGlyphIndex));\n          array.add(widthDetails);\n        }\n\n        lastGlyphIndex = glyph.index;\n      } // } else {\n      //     for (let i : number = 0; i < glyphInfo.length; i++) {\n      //         let glyph : TtfGlyphInfo = glyphInfo[i];\n      //         if (!firstGlyphIndexWasSet) {\n      //             firstGlyphIndexWasSet = true;\n      //             lastGlyphIndex = glyph.index - 1;\n      //         }\n      //         firstGlyphIndex = glyph.index;\n      //         if ((lastGlyphIndex + 1 === glyph.index || (i + 1 === glyphInfo.length)) && glyphInfo.length > 1) {\n      //             // Add glyph index / width.\n      //             widthDetails.add(new PdfNumber(glyph.width));\n      //             array.add(new PdfNumber(firstGlyphIndex));\n      //             array.add(widthDetails);\n      //             widthDetails = new PdfArray();\n      //         }\n      //         lastGlyphIndex = glyph.index;\n      //     }\n      // }\n\n    }\n\n    return array;\n  };\n  /**\n   * Creates cmap.\n   */\n\n\n  UnicodeTrueTypeFont.prototype.generateCmap = function () {\n    if (this.usedChars !== null && this.usedChars !== undefined && this.usedChars.size() > 0) {\n      var glyphChars = this.ttfReader.getGlyphChars(this.usedChars);\n\n      if (glyphChars.size() > 0) {\n        var keys = glyphChars.keys().sort(); // add first and last glyph indexes\n\n        var first = keys[0];\n        var last = keys[keys.length - 1];\n        var middlePart = this.toHexString(first, false) + this.toHexString(last, false) + Operators.newLine;\n        var builder = '';\n        builder += this.cmapPrefix;\n        builder += middlePart;\n        builder += this.cmapEndCodespaceRange;\n        var nextRange = 0;\n\n        for (var i = 0; i < keys.length; i++) {\n          if (nextRange === 0) {\n            if (i !== 0) {\n              builder += this.cmapEndRange;\n            }\n\n            nextRange = Math.min(100, keys.length - i);\n            builder += nextRange;\n            builder += Operators.whiteSpace;\n            builder += this.cmapBeginRange;\n          }\n\n          nextRange -= 1;\n          var key = keys[i];\n          /* tslint:disable */\n\n          builder += this.toHexString(key, true) + this.toHexString(key, true) + this.toHexString(glyphChars.getValue(key), true) + '\\n';\n          /* tslint:enable */\n        }\n\n        builder += this.cmapSuffix;\n        this.cmap.clearStream();\n        this.cmap.isFont = true;\n        this.cmap.write(builder);\n      }\n    }\n  };\n  /**\n   * Generates font program.\n   */\n\n\n  UnicodeTrueTypeFont.prototype.generateFontProgram = function () {\n    var fontProgram = null;\n    this.usedChars = this.usedChars === null || this.usedChars === undefined ? new Dictionary() : this.usedChars;\n    this.ttfReader.setOffset(0);\n    fontProgram = this.ttfReader.readFontProgram(this.usedChars);\n    this.fontProgram.clearStream();\n    this.fontProgram.isFont = true;\n    this.fontProgram.writeBytes(fontProgram);\n  };\n  /**\n   * Calculates flags for the font descriptor.\n   * @private\n   */\n\n\n  UnicodeTrueTypeFont.prototype.getDescriptorFlags = function () {\n    var flags = 0;\n    var metrics = this.ttfReader.metrics;\n\n    if (metrics.isFixedPitch) {\n      flags |= FontDescriptorFlags.FixedPitch;\n    }\n\n    if (metrics.isSymbol) {\n      flags |= FontDescriptorFlags.Symbolic;\n    } else {\n      flags |= FontDescriptorFlags.Nonsymbolic;\n    }\n\n    if (metrics.isItalic) {\n      flags |= FontDescriptorFlags.Italic;\n    }\n\n    if (metrics.isBold) {\n      flags |= FontDescriptorFlags.ForceBold;\n    }\n\n    return flags;\n  };\n  /**\n   * Calculates BoundBox of the descriptor.\n   * @private\n   */\n\n\n  UnicodeTrueTypeFont.prototype.getBoundBox = function () {\n    var rect = this.ttfReader.metrics.fontBox;\n    var width = Math.abs(rect.right - rect.left);\n    var height = Math.abs(rect.top - rect.bottom);\n    var rectangle = new RectangleF(rect.left, rect.bottom, width, height);\n    return rectangle;\n  };\n  /**\n   * Converts integer of decimal system to hex integer.\n   */\n\n\n  UnicodeTrueTypeFont.prototype.toHexString = function (n, isCaseChange) {\n    var s = n.toString(16);\n\n    if (isCaseChange) {\n      s = s.toUpperCase();\n    }\n\n    return '<0000'.substring(0, 5 - s.length) + s + '>';\n  };\n  /**\n   * Stores used symbols.\n   */\n\n\n  UnicodeTrueTypeFont.prototype.setSymbols = function (text) {\n    if (text === null) {\n      throw new Error('Argument Null Exception : text');\n    }\n\n    if (this.usedChars === null || this.usedChars === undefined) {\n      this.usedChars = new Dictionary();\n    }\n\n    for (var i = 0; i < text.length; i++) {\n      var ch = text[i];\n      this.usedChars.setValue(ch, String.fromCharCode(0));\n    } // else {\n    //     if (text === null) {\n    //         throw new Error('Argument Null Exception : glyphs');\n    //     }\n    //     if (this.usedChars === null || this.usedChars === undefined) {\n    //             this.usedChars = new Dictionary<string, string>();\n    //     }\n    //     for (let i : number = 0; i < text.length; i++) {\n    //         let glyphIndex : number = text[i];\n    //         let glyph : TtfGlyphInfo =  this.ttfReader.getGlyph(glyphIndex);\n    //         if (!glyph == null) {\n    //             let c : string = glyph.charCode.toLocaleString();\n    //             this.usedChars.setValue(c, String.fromCharCode(0));\n    //         }\n    //     }\n    // }\n\n\n    if (this.isEmbedFont === false) {\n      this.getDescendantWidth();\n    }\n  };\n\n  return UnicodeTrueTypeFont;\n}();\n\nexport { UnicodeTrueTypeFont };","map":{"version":3,"sources":["C:/Users/Power GSM/Desktop/React-Fito-v1.0-9-April-2021V/React-Fito-v1.0-9-April-2021V/react-fito/node_modules/@syncfusion/ej2-pdf-export/src/implementation/graphics/fonts/unicode-true-type-font.js"],"names":["ByteArray","TtfReader","PdfDictionary","SaveDescendantFontEventHandler","SaveFontDictionaryEventHandler","SaveFontProgramEventHandler","SaveCmapEventHandler","PdfStream","PdfArray","PdfName","PdfNumber","PdfString","PdfReferenceHolder","PdfFontMetrics","StandardWidthTable","DictionaryProperties","Dictionary","FontDescriptorFlags","RectangleF","Operators","UnicodeTrueTypeFont","base64String","size","nameString","dictionaryProperties","isCompress","isEmbedFont","cmapPrefix","newLine","cmapEndCodespaceRange","cmapBeginRange","cmapEndRange","cmapSuffix","undefined","Error","fontSize","fontString","Initialize","prototype","getCharWidth","charCode","codeWidth","ttfReader","getLineWidth","line","width","i","len","length","ch","charWidth","byteArray","writeFromBase64String","fontData","internalBuffer","ttfMetrics","metrics","createInternals","fontDictionary","fontProgram","cmap","descendantFont","initializeMetrics","subsetName","getFontName","createDescendantFont","createCmap","createFontDictionary","createFontProgram","getInternals","ascent","macAscent","descent","macDescent","height","lineGap","name","fontFamily","postScriptName","widthTable","subScriptSizeFactor","superscriptSizeFactor","isBold","builder","index","Math","floor","random","toString","formatName","fontName","ret","replace","isFont","descendantFontBeginSave","items","setValue","type","font","subtype","cIDFontType2","baseFont","cIDToGIDMap","identity","dw","fontDescriptor","createFontDescriptor","systemInfo","createSystemInfo","cIDSystemInfo","descriptor","flags","getDescriptorFlags","fontBBox","fromRectangle","getBoundBox","missingWidth","stemV","italicAngle","capHeight","winAscent","winDescent","leading","avgWidth","fontFile2","maxWidth","xHeight","stemH","cmapBeginSave","fontDictionaryBeginSave","type0","encoding","identityH","descFonts","reference","add","descendantFonts","fontProgramBeginSave","registry","ordering","supplement","usedChars","getDescendantWidth","w","generateCmap","containsKey","toUnicode","generateFontProgram","array","glyphInfo","keys","chLen","glyph","getGlyph","empty","push","sort","a","b","firstGlyphIndex","lastGlyphIndex","firstGlyphIndexWasSet","widthDetails","glyphChars","getGlyphChars","first","last","middlePart","toHexString","nextRange","min","whiteSpace","key","getValue","clearStream","write","setOffset","readFontProgram","writeBytes","isFixedPitch","FixedPitch","isSymbol","Symbolic","Nonsymbolic","isItalic","Italic","ForceBold","rect","fontBox","abs","right","left","top","bottom","rectangle","n","isCaseChange","s","toUpperCase","substring","setSymbols","text","String","fromCharCode"],"mappings":"AAAA;AACA;AACA;AACA,SAASA,SAAT,QAA0B,+BAA1B;AACA,SAASC,SAAT,QAA0B,cAA1B;AACA,SAASC,aAAT,EAAwBC,8BAAxB,EAAwDC,8BAAxD,QAA8F,mCAA9F;AACA,SAASC,2BAAT,EAAsCC,oBAAtC,QAAkE,+BAAlE;AACA,SAASC,SAAT,QAA0B,+BAA1B;AACA,SAASC,QAAT,QAAyB,8BAAzB;AACA,SAASC,OAAT,QAAwB,6BAAxB;AACA,SAASC,SAAT,QAA0B,+BAA1B;AACA,SAASC,SAAT,QAA0B,+BAA1B;AACA,SAASC,kBAAT,QAAmC,kCAAnC;AACA,SAASC,cAAT,QAA+B,oBAA/B;AACA,SAASC,kBAAT,QAAmC,oBAAnC;AACA,SAASC,oBAAT,QAAqC,gDAArC;AACA,SAASC,UAAT,QAA2B,gCAA3B;AACA,SAASC,mBAAT,QAAoC,QAApC;AACA,SAASC,UAAT,QAA2B,6BAA3B;AACA,SAASC,SAAT,QAA0B,oCAA1B;;AACA,IAAIC,mBAAmB;AAAG;AAAe,YAAY;AACjD;AACA;;AACA;AACJ;AACA;AACA;AACI,WAASA,mBAAT,CAA6BC,YAA7B,EAA2CC,IAA3C,EAAiD;AAC7C;AACA,SAAKC,UAAL,GAAkB,4BAAlB;AACA;AACR;AACA;AACA;;AACQ,SAAKC,oBAAL,GAA4B,IAAIT,oBAAJ,EAA5B;AACA;AACR;AACA;AACA;;AACQ,SAAKU,UAAL,GAAkB,KAAlB;AACA;AACR;AACA;;AACQ,SAAKC,WAAL,GAAmB,KAAnB;AACA;AACR;AACA;;AACQ;;AACA,SAAKC,UAAL,GAAkB,mEAAmER,SAAS,CAACS,OAA7E,GAAuF,mFAAvF,GAA6K,iEAA7K,GAAiPT,SAAS,CAACS,OAA7Q;AACA;;AACA;AACR;AACA;;AACQ,SAAKC,qBAAL,GAA6B,sBAAsBV,SAAS,CAACS,OAA7D;AACA;AACR;AACA;;AACQ,SAAKE,cAAL,GAAsB,iBAAiBX,SAAS,CAACS,OAAjD;AACA;AACR;AACA;;AACQ,SAAKG,YAAL,GAAoB,eAAeZ,SAAS,CAACS,OAA7C;AACA;AACR;AACA;;AACQ;;AACA,SAAKI,UAAL,GAAkB,+CAA+C,mCAA/C,GAAqFb,SAAS,CAACS,OAAjH;;AACA,QAAIP,YAAY,KAAK,IAAjB,IAAyBA,YAAY,KAAKY,SAA9C,EAAyD;AACrD,YAAM,IAAIC,KAAJ,CAAU,oCAAV,CAAN;AACH;;AACD,SAAKC,QAAL,GAAgBb,IAAhB;AACA,SAAKc,UAAL,GAAkBf,YAAlB;AACA,SAAKgB,UAAL;AACH,GArDgD,CAsDjD;;AACA;AACJ;AACA;;;AACIjB,EAAAA,mBAAmB,CAACkB,SAApB,CAA8BC,YAA9B,GAA6C,UAAUC,QAAV,EAAoB;AAC7D,QAAIC,SAAS,GAAG,KAAKC,SAAL,CAAeH,YAAf,CAA4BC,QAA5B,CAAhB;AACA,WAAOC,SAAP;AACH,GAHD;AAIA;AACJ;AACA;;;AACIrB,EAAAA,mBAAmB,CAACkB,SAApB,CAA8BK,YAA9B,GAA6C,UAAUC,IAAV,EAAgB;AACzD;AACA;AACA;AACA,QAAIC,KAAK,GAAG,CAAZ;;AACA,SAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGH,IAAI,CAACI,MAA3B,EAAmCF,CAAC,GAAGC,GAAvC,EAA4CD,CAAC,EAA7C,EAAiD;AAC7C,UAAIG,EAAE,GAAGL,IAAI,CAACE,CAAD,CAAb;AACA,UAAII,SAAS,GAAG,KAAKX,YAAL,CAAkBU,EAAlB,CAAhB;AACAJ,MAAAA,KAAK,IAAIK,SAAT;AACH;;AACD,WAAOL,KAAP;AACH,GAXD;AAYA;AACJ;AACA;AACA;;;AACIzB,EAAAA,mBAAmB,CAACkB,SAApB,CAA8BD,UAA9B,GAA2C,YAAY;AACnD,QAAIc,SAAS,GAAG,IAAInD,SAAJ,CAAc,KAAKoC,UAAL,CAAgBY,MAA9B,CAAhB;AACAG,IAAAA,SAAS,CAACC,qBAAV,CAAgC,KAAKhB,UAArC;AACA,SAAKiB,QAAL,GAAgBF,SAAS,CAACG,cAA1B;AACA,SAAKZ,SAAL,GAAiB,IAAIzC,SAAJ,CAAc,KAAKoD,QAAnB,CAAjB;AACA,SAAKE,UAAL,GAAkB,KAAKb,SAAL,CAAec,OAAjC;AACH,GAND;;AAOApC,EAAAA,mBAAmB,CAACkB,SAApB,CAA8BmB,eAA9B,GAAgD,YAAY;AACxD,SAAKC,cAAL,GAAsB,IAAIxD,aAAJ,EAAtB;AACA,SAAKyD,WAAL,GAAmB,IAAIpD,SAAJ,EAAnB;AACA,SAAKqD,IAAL,GAAY,IAAIrD,SAAJ,EAAZ;AACA,SAAKsD,cAAL,GAAsB,IAAI3D,aAAJ,EAAtB;AACA,SAAKsD,OAAL,GAAe,IAAI3C,cAAJ,EAAf;AACA,SAAK6B,SAAL,CAAee,eAAf;AACA,SAAKF,UAAL,GAAkB,KAAKb,SAAL,CAAec,OAAjC;AACA,SAAKM,iBAAL,GARwD,CASxD;;AACA,SAAKC,UAAL,GAAkB,KAAKC,WAAL,EAAlB;AACA,SAAKC,oBAAL;AACA,SAAKC,UAAL;AACA,SAAKC,oBAAL;AACA,SAAKC,iBAAL;AACH,GAfD;;AAgBAhD,EAAAA,mBAAmB,CAACkB,SAApB,CAA8B+B,YAA9B,GAA6C,YAAY;AACrD,WAAO,KAAKX,cAAZ;AACH,GAFD;AAGA;AACJ;AACA;;;AACItC,EAAAA,mBAAmB,CAACkB,SAApB,CAA8BwB,iBAA9B,GAAkD,YAAY;AAC1D,QAAIP,UAAU,GAAG,KAAKb,SAAL,CAAec,OAAhC;AACA,SAAKA,OAAL,CAAac,MAAb,GAAsBf,UAAU,CAACgB,SAAjC;AACA,SAAKf,OAAL,CAAagB,OAAb,GAAuBjB,UAAU,CAACkB,UAAlC;AACA,SAAKjB,OAAL,CAAakB,MAAb,GAAsBnB,UAAU,CAACgB,SAAX,GAAuBhB,UAAU,CAACkB,UAAlC,GAA+ClB,UAAU,CAACoB,OAAhF;AACA,SAAKnB,OAAL,CAAaoB,IAAb,GAAoBrB,UAAU,CAACsB,UAA/B;AACA,SAAKrB,OAAL,CAAasB,cAAb,GAA8BvB,UAAU,CAACuB,cAAzC;AACA,SAAKtB,OAAL,CAAalC,IAAb,GAAoB,KAAKa,QAAzB;AACA,SAAKqB,OAAL,CAAauB,UAAb,GAA0B,IAAIjE,kBAAJ,CAAuByC,UAAU,CAACwB,UAAlC,CAA1B;AACA,SAAKvB,OAAL,CAAamB,OAAb,GAAuBpB,UAAU,CAACoB,OAAlC;AACA,SAAKnB,OAAL,CAAawB,mBAAb,GAAmCzB,UAAU,CAACyB,mBAA9C;AACA,SAAKxB,OAAL,CAAayB,qBAAb,GAAqC1B,UAAU,CAAC0B,qBAAhD;AACA,SAAKzB,OAAL,CAAa0B,MAAb,GAAsB3B,UAAU,CAAC2B,MAAjC;AACH,GAbD;AAcA;AACJ;AACA;;;AACI9D,EAAAA,mBAAmB,CAACkB,SAApB,CAA8B0B,WAA9B,GAA4C,YAAY;AACpD,QAAImB,OAAO,GAAG,EAAd;AACA,QAAIP,IAAJ,CAFoD,CAGpD;;AACA,SAAK,IAAI9B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AACxB,UAAIsC,KAAK,GAAGC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACE,MAAL,MAAiB,KAAK,CAAL,GAAS,CAA1B,CAAX,IAA2C,CAAvD;AACAJ,MAAAA,OAAO,IAAI,KAAK5D,UAAL,CAAgB6D,KAAhB,CAAX;AACH;;AACDD,IAAAA,OAAO,IAAI,GAAX,CARoD,CASpD;;AACAA,IAAAA,OAAO,IAAI,KAAKzC,SAAL,CAAec,OAAf,CAAuBsB,cAAlC;AACAF,IAAAA,IAAI,GAAGO,OAAO,CAACK,QAAR,EAAP,CAXoD,CAYpD;AACA;AACA;;AACAZ,IAAAA,IAAI,GAAG,KAAKa,UAAL,CAAgBb,IAAhB,CAAP;AACA,WAAOA,IAAP;AACH,GAjBD;AAkBA;AACJ;AACA;;;AACIxD,EAAAA,mBAAmB,CAACkB,SAApB,CAA8BmD,UAA9B,GAA2C,UAAUC,QAAV,EAAoB;AAC3D;AACA;AACA;AACA;AACA;AACA;AACA,QAAIC,GAAG,GAAGD,QAAQ,CAACE,OAAT,CAAiB,GAAjB,EAAsB,KAAtB,CAAV;AACAD,IAAAA,GAAG,GAAGA,GAAG,CAACC,OAAJ,CAAY,GAAZ,EAAiB,KAAjB,CAAN;AACAD,IAAAA,GAAG,GAAGA,GAAG,CAACC,OAAJ,CAAY,GAAZ,EAAiB,KAAjB,CAAN;AACAD,IAAAA,GAAG,GAAGA,GAAG,CAACC,OAAJ,CAAY,GAAZ,EAAiB,KAAjB,CAAN;AACAD,IAAAA,GAAG,GAAGA,GAAG,CAACC,OAAJ,CAAY,GAAZ,EAAiB,KAAjB,CAAN;AACAD,IAAAA,GAAG,GAAGA,GAAG,CAACC,OAAJ,CAAY,GAAZ,EAAiB,KAAjB,CAAN;AACAD,IAAAA,GAAG,GAAGA,GAAG,CAACC,OAAJ,CAAY,GAAZ,EAAiB,KAAjB,CAAN;AACAD,IAAAA,GAAG,GAAGA,GAAG,CAACC,OAAJ,CAAY,GAAZ,EAAiB,KAAjB,CAAN;AACAD,IAAAA,GAAG,GAAGA,GAAG,CAACC,OAAJ,CAAY,GAAZ,EAAiB,KAAjB,CAAN;AACAD,IAAAA,GAAG,GAAGA,GAAG,CAACC,OAAJ,CAAY,GAAZ,EAAiB,KAAjB,CAAN;AACA,WAAOD,GAAG,CAACC,OAAJ,CAAY,GAAZ,EAAiB,KAAjB,CAAP;AACH,GAlBD;AAmBA;AACJ;AACA;;;AACIxE,EAAAA,mBAAmB,CAACkB,SAApB,CAA8B2B,oBAA9B,GAAqD,YAAY;AAC7D;AACA,SAAKJ,cAAL,CAAoBgC,MAApB,GAA6B,IAA7B;AACA,SAAKhC,cAAL,CAAoBiC,uBAApB,GAA8C,IAAI3F,8BAAJ,CAAmC,IAAnC,CAA9C;AACA,SAAK0D,cAAL,CAAoBkC,KAApB,CAA0BC,QAA1B,CAAmC,KAAKxE,oBAAL,CAA0ByE,IAA7D,EAAmE,IAAIxF,OAAJ,CAAY,KAAKe,oBAAL,CAA0B0E,IAAtC,CAAnE;AACA,SAAKrC,cAAL,CAAoBkC,KAApB,CAA0BC,QAA1B,CAAmC,KAAKxE,oBAAL,CAA0B2E,OAA7D,EAAsE,IAAI1F,OAAJ,CAAY,KAAKe,oBAAL,CAA0B4E,YAAtC,CAAtE;AACA,SAAKvC,cAAL,CAAoBkC,KAApB,CAA0BC,QAA1B,CAAmC,KAAKxE,oBAAL,CAA0B6E,QAA7D,EAAuE,IAAI5F,OAAJ,CAAY,KAAKsD,UAAjB,CAAvE;AACA,SAAKF,cAAL,CAAoBkC,KAApB,CAA0BC,QAA1B,CAAmC,KAAKxE,oBAAL,CAA0B8E,WAA7D,EAA0E,IAAI7F,OAAJ,CAAY,KAAKe,oBAAL,CAA0B+E,QAAtC,CAA1E;AACA,SAAK1C,cAAL,CAAoBkC,KAApB,CAA0BC,QAA1B,CAAmC,KAAKxE,oBAAL,CAA0BgF,EAA7D,EAAiE,IAAI9F,SAAJ,CAAc,IAAd,CAAjE;AACA,SAAK+F,cAAL,GAAsB,KAAKC,oBAAL,EAAtB;AACA,SAAK7C,cAAL,CAAoBkC,KAApB,CAA0BC,QAA1B,CAAmC,KAAKxE,oBAAL,CAA0BiF,cAA7D,EAA6E,IAAI7F,kBAAJ,CAAuB,KAAK6F,cAA5B,CAA7E;AACA,QAAIE,UAAU,GAAG,KAAKC,gBAAL,EAAjB;AACA,SAAK/C,cAAL,CAAoBkC,KAApB,CAA0BC,QAA1B,CAAmC,KAAKxE,oBAAL,CAA0BqF,aAA7D,EAA4EF,UAA5E;AACH,GAbD;AAcA;AACJ;AACA;;;AACIvF,EAAAA,mBAAmB,CAACkB,SAApB,CAA8BoE,oBAA9B,GAAqD,YAAY;AAC7D,QAAII,UAAU,GAAG,IAAI5G,aAAJ,EAAjB;AACA,QAAIsD,OAAO,GAAG,KAAKd,SAAL,CAAec,OAA7B,CAF6D,CAG7D;;AACAsD,IAAAA,UAAU,CAACjB,MAAX,GAAoB,IAApB;AACAiB,IAAAA,UAAU,CAACf,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0ByE,IAApD,EAA0D,IAAIxF,OAAJ,CAAY,KAAKe,oBAAL,CAA0BiF,cAAtC,CAA1D;AACAK,IAAAA,UAAU,CAACf,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0BkE,QAApD,EAA8D,IAAIjF,OAAJ,CAAY,KAAKsD,UAAjB,CAA9D;AACA+C,IAAAA,UAAU,CAACf,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0BuF,KAApD,EAA2D,IAAIrG,SAAJ,CAAc,KAAKsG,kBAAL,EAAd,CAA3D;AACAF,IAAAA,UAAU,CAACf,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0ByF,QAApD,EAA8DzG,QAAQ,CAAC0G,aAAT,CAAuB,KAAKC,WAAL,EAAvB,CAA9D;AACAL,IAAAA,UAAU,CAACf,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0B4F,YAApD,EAAkE,IAAI1G,SAAJ,CAAc8C,OAAO,CAACuB,UAAR,CAAmB,EAAnB,CAAd,CAAlE;AACA+B,IAAAA,UAAU,CAACf,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0B6F,KAApD,EAA2D,IAAI3G,SAAJ,CAAc8C,OAAO,CAAC6D,KAAtB,CAA3D;AACAP,IAAAA,UAAU,CAACf,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0B8F,WAApD,EAAiE,IAAI5G,SAAJ,CAAc8C,OAAO,CAAC8D,WAAtB,CAAjE;AACAR,IAAAA,UAAU,CAACf,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0B+F,SAApD,EAA+D,IAAI7G,SAAJ,CAAc8C,OAAO,CAAC+D,SAAtB,CAA/D;AACAT,IAAAA,UAAU,CAACf,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0B8C,MAApD,EAA4D,IAAI5D,SAAJ,CAAc8C,OAAO,CAACgE,SAAtB,CAA5D;AACAV,IAAAA,UAAU,CAACf,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0BgD,OAApD,EAA6D,IAAI9D,SAAJ,CAAc8C,OAAO,CAACiE,UAAtB,CAA7D;AACAX,IAAAA,UAAU,CAACf,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0BkG,OAApD,EAA6D,IAAIhH,SAAJ,CAAc8C,OAAO,CAACkE,OAAtB,CAA7D;AACAZ,IAAAA,UAAU,CAACf,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0BmG,QAApD,EAA8D,IAAIjH,SAAJ,CAAc8C,OAAO,CAACuB,UAAR,CAAmB,EAAnB,CAAd,CAA9D;AACA+B,IAAAA,UAAU,CAACf,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0BoG,SAApD,EAA+D,IAAIhH,kBAAJ,CAAuB,KAAK+C,WAA5B,CAA/D;AACAmD,IAAAA,UAAU,CAACf,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0BqG,QAApD,EAA8D,IAAInH,SAAJ,CAAc8C,OAAO,CAACuB,UAAR,CAAmB,EAAnB,CAAd,CAA9D;AACA+B,IAAAA,UAAU,CAACf,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0BsG,OAApD,EAA6D,IAAIpH,SAAJ,CAAc,CAAd,CAA7D;AACAoG,IAAAA,UAAU,CAACf,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0BuG,KAApD,EAA2D,IAAIrH,SAAJ,CAAc,CAAd,CAA3D;AACA,WAAOoG,UAAP;AACH,GAtBD;AAuBA;AACJ;AACA;AACA;;;AACI1F,EAAAA,mBAAmB,CAACkB,SAApB,CAA8B4B,UAA9B,GAA2C,YAAY;AACnD,SAAKN,IAAL,CAAUoE,aAAV,GAA0B,IAAI1H,oBAAJ,CAAyB,IAAzB,CAA1B;AACH,GAFD;AAGA;AACJ;AACA;;;AACIc,EAAAA,mBAAmB,CAACkB,SAApB,CAA8B6B,oBAA9B,GAAqD,YAAY;AAC7D;AACA,SAAKT,cAAL,CAAoBmC,MAApB,GAA6B,IAA7B;AACA,SAAKnC,cAAL,CAAoBuE,uBAApB,GAA8C,IAAI7H,8BAAJ,CAAmC,IAAnC,CAA9C;AACA,SAAKsD,cAAL,CAAoBqC,KAApB,CAA0BC,QAA1B,CAAmC,KAAKxE,oBAAL,CAA0ByE,IAA7D,EAAmE,IAAIxF,OAAJ,CAAY,KAAKe,oBAAL,CAA0B0E,IAAtC,CAAnE;AACA,SAAKxC,cAAL,CAAoBqC,KAApB,CAA0BC,QAA1B,CAAmC,KAAKxE,oBAAL,CAA0B6E,QAA7D,EAAuE,IAAI5F,OAAJ,CAAY,KAAKsD,UAAjB,CAAvE;AACA,SAAKL,cAAL,CAAoBqC,KAApB,CAA0BC,QAA1B,CAAmC,KAAKxE,oBAAL,CAA0B2E,OAA7D,EAAsE,IAAI1F,OAAJ,CAAY,KAAKe,oBAAL,CAA0B0G,KAAtC,CAAtE;AACA,SAAKxE,cAAL,CAAoBqC,KAApB,CAA0BC,QAA1B,CAAmC,KAAKxE,oBAAL,CAA0B2G,QAA7D,EAAuE,IAAI1H,OAAJ,CAAY,KAAKe,oBAAL,CAA0B4G,SAAtC,CAAvE;AACA,QAAIC,SAAS,GAAG,IAAI7H,QAAJ,EAAhB;AACA,QAAI8H,SAAS,GAAG,IAAI1H,kBAAJ,CAAuB,KAAKiD,cAA5B,CAAhB,CAT6D,CAU7D;;AACAwE,IAAAA,SAAS,CAACxC,MAAV,GAAmB,IAAnB;AACAwC,IAAAA,SAAS,CAACE,GAAV,CAAcD,SAAd;AACA,SAAK5E,cAAL,CAAoBqC,KAApB,CAA0BC,QAA1B,CAAmC,KAAKxE,oBAAL,CAA0BgH,eAA7D,EAA8EH,SAA9E;AACH,GAdD;AAeA;AACJ;AACA;;;AACIjH,EAAAA,mBAAmB,CAACkB,SAApB,CAA8B8B,iBAA9B,GAAkD,YAAY;AAC1D,SAAKT,WAAL,CAAiB8E,oBAAjB,GAAwC,IAAIpI,2BAAJ,CAAgC,IAAhC,CAAxC;AACH,GAFD;AAGA;AACJ;AACA;AACA;;;AACIe,EAAAA,mBAAmB,CAACkB,SAApB,CAA8BsE,gBAA9B,GAAiD,YAAY;AACzD,QAAID,UAAU,GAAG,IAAIzG,aAAJ,EAAjB;AACAyG,IAAAA,UAAU,CAACZ,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0BkH,QAApD,EAA8D,IAAI/H,SAAJ,CAAc,OAAd,CAA9D;AACAgG,IAAAA,UAAU,CAACZ,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0BmH,QAApD,EAA8D,IAAIhI,SAAJ,CAAc,KAAKa,oBAAL,CAA0B+E,QAAxC,CAA9D;AACAI,IAAAA,UAAU,CAACZ,KAAX,CAAiBC,QAAjB,CAA0B,KAAKxE,oBAAL,CAA0BoH,UAApD,EAAgE,IAAIlI,SAAJ,CAAc,CAAd,CAAhE;AACA,WAAOiG,UAAP;AACH,GAND;AAOA;AACJ;AACA;;;AACIvF,EAAAA,mBAAmB,CAACkB,SAApB,CAA8BwD,uBAA9B,GAAwD,YAAY;AAChE,QAAI,KAAK+C,SAAL,KAAmB,IAAnB,IAA2B,KAAKA,SAAL,KAAmB5G,SAA9C,IAA2D,KAAK4G,SAAL,CAAevH,IAAf,KAAwB,CAAvF,EAA0F;AACtF,UAAIuB,KAAK,GAAG,KAAKiG,kBAAL,EAAZ;;AACA,UAAIjG,KAAK,KAAK,IAAd,EAAoB;AAChB,aAAKgB,cAAL,CAAoBkC,KAApB,CAA0BC,QAA1B,CAAmC,KAAKxE,oBAAL,CAA0BuH,CAA7D,EAAgElG,KAAhE;AACH;AACJ;AACJ,GAPD;AAQA;AACJ;AACA;;;AACIzB,EAAAA,mBAAmB,CAACkB,SAApB,CAA8B0F,aAA9B,GAA8C,YAAY;AACtD,SAAKgB,YAAL;AACH,GAFD;AAGA;AACJ;AACA;;AACI;;;AACA5H,EAAAA,mBAAmB,CAACkB,SAApB,CAA8B2F,uBAA9B,GAAwD,YAAY;AAChE,QAAI,KAAKY,SAAL,KAAmB,IAAnB,IAA2B,KAAKA,SAAL,KAAmB5G,SAA9C,IAA2D,KAAK4G,SAAL,CAAevH,IAAf,KAAwB,CAAnF,IAAwF,CAAC,KAAKoC,cAAL,CAAoBuF,WAApB,CAAgC,KAAKzH,oBAAL,CAA0B0H,SAA1D,CAA7F,EAAmK;AAC/J,WAAKxF,cAAL,CAAoBqC,KAApB,CAA0BC,QAA1B,CAAmC,KAAKxE,oBAAL,CAA0B0H,SAA7D,EAAwE,IAAItI,kBAAJ,CAAuB,KAAKgD,IAA5B,CAAxE;AACH;AACJ,GAJD;AAKA;;AACA;AACJ;AACA;;;AACIxC,EAAAA,mBAAmB,CAACkB,SAApB,CAA8BmG,oBAA9B,GAAqD,YAAY;AAC7D,SAAKhH,UAAL,GAAkB,IAAlB;AACA,SAAK0H,mBAAL;AACH,GAHD;AAIA;AACJ;AACA;;;AACI/H,EAAAA,mBAAmB,CAACkB,SAApB,CAA8BwG,kBAA9B,GAAmD,YAAY;AAC3D,QAAIM,KAAK,GAAG,IAAI5I,QAAJ,EAAZ;;AACA,QAAI,KAAKqI,SAAL,KAAmB,IAAnB,IAA2B,KAAKA,SAAL,KAAmB5G,SAA9C,IAA2D,KAAK4G,SAAL,CAAevH,IAAf,KAAwB,CAAvF,EAA0F;AACtF,UAAI+H,SAAS,GAAG,EAAhB,CADsF,CAEtF;;AACA,UAAIC,IAAI,GAAG,KAAKT,SAAL,CAAeS,IAAf,EAAX;;AACA,WAAK,IAAIxG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwG,IAAI,CAACtG,MAAzB,EAAiCF,CAAC,EAAlC,EAAsC;AAClC,YAAIyG,KAAK,GAAGD,IAAI,CAACxG,CAAD,CAAhB;AACA,YAAI0G,KAAK,GAAG,KAAK9G,SAAL,CAAe+G,QAAf,CAAwBF,KAAxB,CAAZ;;AACA,YAAIC,KAAK,CAACE,KAAV,EAAiB;AACb;AACH;;AACDL,QAAAA,SAAS,CAACM,IAAV,CAAeH,KAAf;AACH,OAXqF,CAYtF;AACA;AACA;;;AACAH,MAAAA,SAAS,CAACO,IAAV,CAAe,UAAUC,CAAV,EAAaC,CAAb,EAAgB;AAAE,eAAOD,CAAC,CAACzE,KAAF,GAAU0E,CAAC,CAAC1E,KAAnB;AAA2B,OAA5D;AACA,UAAI2E,eAAe,GAAG,CAAtB;AACA,UAAIC,cAAc,GAAG,CAArB;AACA,UAAIC,qBAAqB,GAAG,KAA5B;AACA,UAAIC,YAAY,GAAG,IAAI1J,QAAJ,EAAnB,CAnBsF,CAoBtF;;AACA,WAAK,IAAIsC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGuG,SAAS,CAACrG,MAA9B,EAAsCF,CAAC,EAAvC,EAA2C;AACvC,YAAI0G,KAAK,GAAGH,SAAS,CAACvG,CAAD,CAArB;;AACA,YAAI,CAACmH,qBAAL,EAA4B;AACxBA,UAAAA,qBAAqB,GAAG,IAAxB;AACAF,UAAAA,eAAe,GAAGP,KAAK,CAACpE,KAAxB;AACA4E,UAAAA,cAAc,GAAGR,KAAK,CAACpE,KAAN,GAAc,CAA/B;AACH;;AACD,YAAI,CAAC4E,cAAc,GAAG,CAAjB,KAAuBR,KAAK,CAACpE,KAA7B,IAAuCtC,CAAC,GAAG,CAAJ,KAAUuG,SAAS,CAACrG,MAA5D,KAAwEqG,SAAS,CAACrG,MAAV,GAAmB,CAA/F,EAAkG;AAC9F;AACAoG,UAAAA,KAAK,CAACb,GAAN,CAAU,IAAI7H,SAAJ,CAAcqJ,eAAd,CAAV;;AACA,cAAIjH,CAAC,KAAK,CAAV,EAAa;AACTsG,YAAAA,KAAK,CAACb,GAAN,CAAU2B,YAAV;AACH;;AACDH,UAAAA,eAAe,GAAGP,KAAK,CAACpE,KAAxB;AACA8E,UAAAA,YAAY,GAAG,IAAI1J,QAAJ,EAAf;AACH;;AACD0J,QAAAA,YAAY,CAAC3B,GAAb,CAAiB,IAAI7H,SAAJ,CAAc8I,KAAK,CAAC3G,KAApB,CAAjB;;AACA,YAAIC,CAAC,GAAG,CAAJ,KAAUuG,SAAS,CAACrG,MAAxB,EAAgC;AAC5BoG,UAAAA,KAAK,CAACb,GAAN,CAAU,IAAI7H,SAAJ,CAAcqJ,eAAd,CAAV;AACAX,UAAAA,KAAK,CAACb,GAAN,CAAU2B,YAAV;AACH;;AACDF,QAAAA,cAAc,GAAGR,KAAK,CAACpE,KAAvB;AACH,OA3CqF,CA4CtF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACH;;AACD,WAAOgE,KAAP;AACH,GAlED;AAmEA;AACJ;AACA;;;AACIhI,EAAAA,mBAAmB,CAACkB,SAApB,CAA8B0G,YAA9B,GAA6C,YAAY;AACrD,QAAI,KAAKH,SAAL,KAAmB,IAAnB,IAA2B,KAAKA,SAAL,KAAmB5G,SAA9C,IAA2D,KAAK4G,SAAL,CAAevH,IAAf,KAAwB,CAAvF,EAA0F;AACtF,UAAI6I,UAAU,GAAG,KAAKzH,SAAL,CAAe0H,aAAf,CAA6B,KAAKvB,SAAlC,CAAjB;;AACA,UAAIsB,UAAU,CAAC7I,IAAX,KAAoB,CAAxB,EAA2B;AACvB,YAAIgI,IAAI,GAAGa,UAAU,CAACb,IAAX,GAAkBM,IAAlB,EAAX,CADuB,CAEvB;;AACA,YAAIS,KAAK,GAAGf,IAAI,CAAC,CAAD,CAAhB;AACA,YAAIgB,IAAI,GAAGhB,IAAI,CAACA,IAAI,CAACtG,MAAL,GAAc,CAAf,CAAf;AACA,YAAIuH,UAAU,GAAG,KAAKC,WAAL,CAAiBH,KAAjB,EAAwB,KAAxB,IAAiC,KAAKG,WAAL,CAAiBF,IAAjB,EAAuB,KAAvB,CAAjC,GAAiEnJ,SAAS,CAACS,OAA5F;AACA,YAAIuD,OAAO,GAAG,EAAd;AACAA,QAAAA,OAAO,IAAI,KAAKxD,UAAhB;AACAwD,QAAAA,OAAO,IAAIoF,UAAX;AACApF,QAAAA,OAAO,IAAI,KAAKtD,qBAAhB;AACA,YAAI4I,SAAS,GAAG,CAAhB;;AACA,aAAK,IAAI3H,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGwG,IAAI,CAACtG,MAAzB,EAAiCF,CAAC,EAAlC,EAAsC;AAClC,cAAI2H,SAAS,KAAK,CAAlB,EAAqB;AACjB,gBAAI3H,CAAC,KAAK,CAAV,EAAa;AACTqC,cAAAA,OAAO,IAAI,KAAKpD,YAAhB;AACH;;AACD0I,YAAAA,SAAS,GAAGpF,IAAI,CAACqF,GAAL,CAAS,GAAT,EAAcpB,IAAI,CAACtG,MAAL,GAAcF,CAA5B,CAAZ;AACAqC,YAAAA,OAAO,IAAIsF,SAAX;AACAtF,YAAAA,OAAO,IAAIhE,SAAS,CAACwJ,UAArB;AACAxF,YAAAA,OAAO,IAAI,KAAKrD,cAAhB;AACH;;AACD2I,UAAAA,SAAS,IAAI,CAAb;AACA,cAAIG,GAAG,GAAGtB,IAAI,CAACxG,CAAD,CAAd;AACA;;AACAqC,UAAAA,OAAO,IAAI,KAAKqF,WAAL,CAAiBI,GAAjB,EAAsB,IAAtB,IAA8B,KAAKJ,WAAL,CAAiBI,GAAjB,EAAsB,IAAtB,CAA9B,GAA4D,KAAKJ,WAAL,CAAiBL,UAAU,CAACU,QAAX,CAAoBD,GAApB,CAAjB,EAA2C,IAA3C,CAA5D,GAA+G,IAA1H;AACA;AACH;;AACDzF,QAAAA,OAAO,IAAI,KAAKnD,UAAhB;AACA,aAAK4B,IAAL,CAAUkH,WAAV;AACA,aAAKlH,IAAL,CAAUiC,MAAV,GAAmB,IAAnB;AACA,aAAKjC,IAAL,CAAUmH,KAAV,CAAgB5F,OAAhB;AACH;AACJ;AACJ,GApCD;AAqCA;AACJ;AACA;;;AACI/D,EAAAA,mBAAmB,CAACkB,SAApB,CAA8B6G,mBAA9B,GAAoD,YAAY;AAC5D,QAAIxF,WAAW,GAAG,IAAlB;AACA,SAAKkF,SAAL,GAAkB,KAAKA,SAAL,KAAmB,IAAnB,IAA2B,KAAKA,SAAL,KAAmB5G,SAA/C,GAA4D,IAAIjB,UAAJ,EAA5D,GAA+E,KAAK6H,SAArG;AACA,SAAKnG,SAAL,CAAesI,SAAf,CAAyB,CAAzB;AACArH,IAAAA,WAAW,GAAG,KAAKjB,SAAL,CAAeuI,eAAf,CAA+B,KAAKpC,SAApC,CAAd;AACA,SAAKlF,WAAL,CAAiBmH,WAAjB;AACA,SAAKnH,WAAL,CAAiBkC,MAAjB,GAA0B,IAA1B;AACA,SAAKlC,WAAL,CAAiBuH,UAAjB,CAA4BvH,WAA5B;AACH,GARD;AASA;AACJ;AACA;AACA;;;AACIvC,EAAAA,mBAAmB,CAACkB,SAApB,CAA8B0E,kBAA9B,GAAmD,YAAY;AAC3D,QAAID,KAAK,GAAG,CAAZ;AACA,QAAIvD,OAAO,GAAG,KAAKd,SAAL,CAAec,OAA7B;;AACA,QAAIA,OAAO,CAAC2H,YAAZ,EAA0B;AACtBpE,MAAAA,KAAK,IAAI9F,mBAAmB,CAACmK,UAA7B;AACH;;AACD,QAAI5H,OAAO,CAAC6H,QAAZ,EAAsB;AAClBtE,MAAAA,KAAK,IAAI9F,mBAAmB,CAACqK,QAA7B;AACH,KAFD,MAGK;AACDvE,MAAAA,KAAK,IAAI9F,mBAAmB,CAACsK,WAA7B;AACH;;AACD,QAAI/H,OAAO,CAACgI,QAAZ,EAAsB;AAClBzE,MAAAA,KAAK,IAAI9F,mBAAmB,CAACwK,MAA7B;AACH;;AACD,QAAIjI,OAAO,CAAC0B,MAAZ,EAAoB;AAChB6B,MAAAA,KAAK,IAAI9F,mBAAmB,CAACyK,SAA7B;AACH;;AACD,WAAO3E,KAAP;AACH,GAnBD;AAoBA;AACJ;AACA;AACA;;;AACI3F,EAAAA,mBAAmB,CAACkB,SAApB,CAA8B6E,WAA9B,GAA4C,YAAY;AACpD,QAAIwE,IAAI,GAAG,KAAKjJ,SAAL,CAAec,OAAf,CAAuBoI,OAAlC;AACA,QAAI/I,KAAK,GAAGwC,IAAI,CAACwG,GAAL,CAASF,IAAI,CAACG,KAAL,GAAaH,IAAI,CAACI,IAA3B,CAAZ;AACA,QAAIrH,MAAM,GAAGW,IAAI,CAACwG,GAAL,CAASF,IAAI,CAACK,GAAL,GAAWL,IAAI,CAACM,MAAzB,CAAb;AACA,QAAIC,SAAS,GAAG,IAAIhL,UAAJ,CAAeyK,IAAI,CAACI,IAApB,EAA0BJ,IAAI,CAACM,MAA/B,EAAuCpJ,KAAvC,EAA8C6B,MAA9C,CAAhB;AACA,WAAOwH,SAAP;AACH,GAND;AAOA;AACJ;AACA;;;AACI9K,EAAAA,mBAAmB,CAACkB,SAApB,CAA8BkI,WAA9B,GAA4C,UAAU2B,CAAV,EAAaC,YAAb,EAA2B;AACnE,QAAIC,CAAC,GAAGF,CAAC,CAAC3G,QAAF,CAAW,EAAX,CAAR;;AACA,QAAI4G,YAAJ,EAAkB;AACdC,MAAAA,CAAC,GAAGA,CAAC,CAACC,WAAF,EAAJ;AACH;;AACD,WAAO,QAAQC,SAAR,CAAkB,CAAlB,EAAqB,IAAIF,CAAC,CAACrJ,MAA3B,IAAqCqJ,CAArC,GAAyC,GAAhD;AACH,GAND;AAOA;AACJ;AACA;;;AACIjL,EAAAA,mBAAmB,CAACkB,SAApB,CAA8BkK,UAA9B,GAA2C,UAAUC,IAAV,EAAgB;AACvD,QAAIA,IAAI,KAAK,IAAb,EAAmB;AACf,YAAM,IAAIvK,KAAJ,CAAU,gCAAV,CAAN;AACH;;AACD,QAAI,KAAK2G,SAAL,KAAmB,IAAnB,IAA2B,KAAKA,SAAL,KAAmB5G,SAAlD,EAA6D;AACzD,WAAK4G,SAAL,GAAiB,IAAI7H,UAAJ,EAAjB;AACH;;AACD,SAAK,IAAI8B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2J,IAAI,CAACzJ,MAAzB,EAAiCF,CAAC,EAAlC,EAAsC;AAClC,UAAIG,EAAE,GAAGwJ,IAAI,CAAC3J,CAAD,CAAb;AACA,WAAK+F,SAAL,CAAe7C,QAAf,CAAwB/C,EAAxB,EAA4ByJ,MAAM,CAACC,YAAP,CAAoB,CAApB,CAA5B;AACH,KAVsD,CAWvD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,QAAI,KAAKjL,WAAL,KAAqB,KAAzB,EAAgC;AAC5B,WAAKoH,kBAAL;AACH;AACJ,GA9BD;;AA+BA,SAAO1H,mBAAP;AACH,CAxewC,EAAzC;;AAyeA,SAASA,mBAAT","sourcesContent":["/**\n * TrueTypeFont.ts class for EJ2-PDF\n */\nimport { ByteArray } from './../../graphics/images/index';\nimport { TtfReader } from './ttf-reader';\nimport { PdfDictionary, SaveDescendantFontEventHandler, SaveFontDictionaryEventHandler } from './../../primitives/pdf-dictionary';\nimport { SaveFontProgramEventHandler, SaveCmapEventHandler } from './../../primitives/pdf-stream';\nimport { PdfStream } from './../../primitives/pdf-stream';\nimport { PdfArray } from './../../primitives/pdf-array';\nimport { PdfName } from './../../primitives/pdf-name';\nimport { PdfNumber } from './../../primitives/pdf-number';\nimport { PdfString } from './../../primitives/pdf-string';\nimport { PdfReferenceHolder } from './../../primitives/pdf-reference';\nimport { PdfFontMetrics } from './pdf-font-metrics';\nimport { StandardWidthTable } from './pdf-font-metrics';\nimport { DictionaryProperties } from './../../input-output/pdf-dictionary-properties';\nimport { Dictionary } from './../../collections/dictionary';\nimport { FontDescriptorFlags } from './enum';\nimport { RectangleF } from './../../drawing/pdf-drawing';\nimport { Operators } from './../../input-output/pdf-operators';\nvar UnicodeTrueTypeFont = /** @class */ (function () {\n    /* tslint:enable */\n    //Constructors\n    /**\n     * Initializes a new instance of the `PdfTrueTypeFont` class.\n     * @private\n     */\n    function UnicodeTrueTypeFont(base64String, size) {\n        // Fields\n        this.nameString = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\n        /**\n         * Specifies the Internal variable to store fields of `PdfDictionaryProperties`.\n         * @private\n         */\n        this.dictionaryProperties = new DictionaryProperties();\n        /**\n         * Indicates whether the font program is compressed or not.\n         * @private\n         */\n        this.isCompress = false;\n        /**\n         * Indicates whether the font is embedded or not.\n         */\n        this.isEmbedFont = false;\n        /**\n         * Cmap table's start prefix.\n         */\n        /* tslint:disable */\n        this.cmapPrefix = '/CIDInit /ProcSet findresource begin\\n12 dict begin\\nbegincmap' + Operators.newLine + '/CIDSystemInfo << /Registry (Adobe)/Ordering (UCS)/Supplement 0>> def\\n/CMapName ' + '/Adobe-Identity-UCS def\\n/CMapType 2 def\\n1 begincodespacerange' + Operators.newLine;\n        /* tslint:enable */\n        /**\n         * Cmap table's start suffix.\n         */\n        this.cmapEndCodespaceRange = 'endcodespacerange' + Operators.newLine;\n        /**\n         * Cmap's begin range marker.\n         */\n        this.cmapBeginRange = 'beginbfrange' + Operators.newLine;\n        /**\n         * Cmap's end range marker.\n         */\n        this.cmapEndRange = 'endbfrange' + Operators.newLine;\n        /**\n         * Cmap table's end\n         */\n        /* tslint:disable */\n        this.cmapSuffix = 'endbfrange\\nendcmap\\nCMapName currentdict ' + '/CMap defineresource pop\\nend end' + Operators.newLine;\n        if (base64String === null || base64String === undefined) {\n            throw new Error('ArgumentNullException:base64String');\n        }\n        this.fontSize = size;\n        this.fontString = base64String;\n        this.Initialize();\n    }\n    //Implementation\n    /**\n     * Returns width of the char symbol.\n     */\n    UnicodeTrueTypeFont.prototype.getCharWidth = function (charCode) {\n        var codeWidth = this.ttfReader.getCharWidth(charCode);\n        return codeWidth;\n    };\n    /**\n     * Returns width of the text line.\n     */\n    UnicodeTrueTypeFont.prototype.getLineWidth = function (line) {\n        // if (line == null) {\n        //     throw new Error('ArgumentNullException : line');\n        // }\n        var width = 0;\n        for (var i = 0, len = line.length; i < len; i++) {\n            var ch = line[i];\n            var charWidth = this.getCharWidth(ch);\n            width += charWidth;\n        }\n        return width;\n    };\n    /**\n     * Initializes a new instance of the `PdfTrueTypeFont` class.\n     * @private\n     */\n    UnicodeTrueTypeFont.prototype.Initialize = function () {\n        var byteArray = new ByteArray(this.fontString.length);\n        byteArray.writeFromBase64String(this.fontString);\n        this.fontData = byteArray.internalBuffer;\n        this.ttfReader = new TtfReader(this.fontData);\n        this.ttfMetrics = this.ttfReader.metrics;\n    };\n    UnicodeTrueTypeFont.prototype.createInternals = function () {\n        this.fontDictionary = new PdfDictionary();\n        this.fontProgram = new PdfStream();\n        this.cmap = new PdfStream();\n        this.descendantFont = new PdfDictionary();\n        this.metrics = new PdfFontMetrics();\n        this.ttfReader.createInternals();\n        this.ttfMetrics = this.ttfReader.metrics;\n        this.initializeMetrics();\n        // Create all the dictionaries of the font.\n        this.subsetName = this.getFontName();\n        this.createDescendantFont();\n        this.createCmap();\n        this.createFontDictionary();\n        this.createFontProgram();\n    };\n    UnicodeTrueTypeFont.prototype.getInternals = function () {\n        return this.fontDictionary;\n    };\n    /**\n     * Initializes metrics.\n     */\n    UnicodeTrueTypeFont.prototype.initializeMetrics = function () {\n        var ttfMetrics = this.ttfReader.metrics;\n        this.metrics.ascent = ttfMetrics.macAscent;\n        this.metrics.descent = ttfMetrics.macDescent;\n        this.metrics.height = ttfMetrics.macAscent - ttfMetrics.macDescent + ttfMetrics.lineGap;\n        this.metrics.name = ttfMetrics.fontFamily;\n        this.metrics.postScriptName = ttfMetrics.postScriptName;\n        this.metrics.size = this.fontSize;\n        this.metrics.widthTable = new StandardWidthTable(ttfMetrics.widthTable);\n        this.metrics.lineGap = ttfMetrics.lineGap;\n        this.metrics.subScriptSizeFactor = ttfMetrics.subScriptSizeFactor;\n        this.metrics.superscriptSizeFactor = ttfMetrics.superscriptSizeFactor;\n        this.metrics.isBold = ttfMetrics.isBold;\n    };\n    /**\n     * Gets random string.\n     */\n    UnicodeTrueTypeFont.prototype.getFontName = function () {\n        var builder = '';\n        var name;\n        // if (this.isEmbed === false) {\n        for (var i = 0; i < 6; i++) {\n            var index = Math.floor(Math.random() * (25 - 0 + 1)) + 0;\n            builder += this.nameString[index];\n        }\n        builder += '+';\n        // }\n        builder += this.ttfReader.metrics.postScriptName;\n        name = builder.toString();\n        // if (name === '') {\n        //     name = this.ttfReader.metrics.fontFamily;\n        // }\n        name = this.formatName(name);\n        return name;\n    };\n    /**\n     * Generates name of the font.\n     */\n    UnicodeTrueTypeFont.prototype.formatName = function (fontName) {\n        // if (fontName === null) {\n        //     throw new Error('ArgumentNullException : fontName');\n        // }\n        // if (fontName === '') {\n        //     throw new Error('ArgumentOutOfRangeException : fontName, Parameter can not be empty');\n        // }\n        var ret = fontName.replace('(', '#28');\n        ret = ret.replace(')', '#29');\n        ret = ret.replace('[', '#5B');\n        ret = ret.replace(']', '#5D');\n        ret = ret.replace('<', '#3C');\n        ret = ret.replace('>', '#3E');\n        ret = ret.replace('{', '#7B');\n        ret = ret.replace('}', '#7D');\n        ret = ret.replace('/', '#2F');\n        ret = ret.replace('%', '#25');\n        return ret.replace(' ', '#20');\n    };\n    /**\n     * Creates descendant font.\n     */\n    UnicodeTrueTypeFont.prototype.createDescendantFont = function () {\n        // Set property used to clone Font every time\n        this.descendantFont.isFont = true;\n        this.descendantFont.descendantFontBeginSave = new SaveDescendantFontEventHandler(this);\n        this.descendantFont.items.setValue(this.dictionaryProperties.type, new PdfName(this.dictionaryProperties.font));\n        this.descendantFont.items.setValue(this.dictionaryProperties.subtype, new PdfName(this.dictionaryProperties.cIDFontType2));\n        this.descendantFont.items.setValue(this.dictionaryProperties.baseFont, new PdfName(this.subsetName));\n        this.descendantFont.items.setValue(this.dictionaryProperties.cIDToGIDMap, new PdfName(this.dictionaryProperties.identity));\n        this.descendantFont.items.setValue(this.dictionaryProperties.dw, new PdfNumber(1000));\n        this.fontDescriptor = this.createFontDescriptor();\n        this.descendantFont.items.setValue(this.dictionaryProperties.fontDescriptor, new PdfReferenceHolder(this.fontDescriptor));\n        var systemInfo = this.createSystemInfo();\n        this.descendantFont.items.setValue(this.dictionaryProperties.cIDSystemInfo, systemInfo);\n    };\n    /**\n     * Creates font descriptor.\n     */\n    UnicodeTrueTypeFont.prototype.createFontDescriptor = function () {\n        var descriptor = new PdfDictionary();\n        var metrics = this.ttfReader.metrics;\n        // Set property used to clone Font every time\n        descriptor.isFont = true;\n        descriptor.items.setValue(this.dictionaryProperties.type, new PdfName(this.dictionaryProperties.fontDescriptor));\n        descriptor.items.setValue(this.dictionaryProperties.fontName, new PdfName(this.subsetName));\n        descriptor.items.setValue(this.dictionaryProperties.flags, new PdfNumber(this.getDescriptorFlags()));\n        descriptor.items.setValue(this.dictionaryProperties.fontBBox, PdfArray.fromRectangle(this.getBoundBox()));\n        descriptor.items.setValue(this.dictionaryProperties.missingWidth, new PdfNumber(metrics.widthTable[32]));\n        descriptor.items.setValue(this.dictionaryProperties.stemV, new PdfNumber(metrics.stemV));\n        descriptor.items.setValue(this.dictionaryProperties.italicAngle, new PdfNumber(metrics.italicAngle));\n        descriptor.items.setValue(this.dictionaryProperties.capHeight, new PdfNumber(metrics.capHeight));\n        descriptor.items.setValue(this.dictionaryProperties.ascent, new PdfNumber(metrics.winAscent));\n        descriptor.items.setValue(this.dictionaryProperties.descent, new PdfNumber(metrics.winDescent));\n        descriptor.items.setValue(this.dictionaryProperties.leading, new PdfNumber(metrics.leading));\n        descriptor.items.setValue(this.dictionaryProperties.avgWidth, new PdfNumber(metrics.widthTable[32]));\n        descriptor.items.setValue(this.dictionaryProperties.fontFile2, new PdfReferenceHolder(this.fontProgram));\n        descriptor.items.setValue(this.dictionaryProperties.maxWidth, new PdfNumber(metrics.widthTable[32]));\n        descriptor.items.setValue(this.dictionaryProperties.xHeight, new PdfNumber(0));\n        descriptor.items.setValue(this.dictionaryProperties.stemH, new PdfNumber(0));\n        return descriptor;\n    };\n    /**\n     * Generates cmap.\n     * @private\n     */\n    UnicodeTrueTypeFont.prototype.createCmap = function () {\n        this.cmap.cmapBeginSave = new SaveCmapEventHandler(this);\n    };\n    /**\n     * Generates font dictionary.\n     */\n    UnicodeTrueTypeFont.prototype.createFontDictionary = function () {\n        // Set property used to clone Font every time\n        this.fontDictionary.isFont = true;\n        this.fontDictionary.fontDictionaryBeginSave = new SaveFontDictionaryEventHandler(this);\n        this.fontDictionary.items.setValue(this.dictionaryProperties.type, new PdfName(this.dictionaryProperties.font));\n        this.fontDictionary.items.setValue(this.dictionaryProperties.baseFont, new PdfName(this.subsetName));\n        this.fontDictionary.items.setValue(this.dictionaryProperties.subtype, new PdfName(this.dictionaryProperties.type0));\n        this.fontDictionary.items.setValue(this.dictionaryProperties.encoding, new PdfName(this.dictionaryProperties.identityH));\n        var descFonts = new PdfArray();\n        var reference = new PdfReferenceHolder(this.descendantFont);\n        // Set property used to clone Font every time\n        descFonts.isFont = true;\n        descFonts.add(reference);\n        this.fontDictionary.items.setValue(this.dictionaryProperties.descendantFonts, descFonts);\n    };\n    /**\n     * Creates font program.\n     */\n    UnicodeTrueTypeFont.prototype.createFontProgram = function () {\n        this.fontProgram.fontProgramBeginSave = new SaveFontProgramEventHandler(this);\n    };\n    /**\n     * Creates system info dictionary for CID font.\n     * @private\n     */\n    UnicodeTrueTypeFont.prototype.createSystemInfo = function () {\n        var systemInfo = new PdfDictionary();\n        systemInfo.items.setValue(this.dictionaryProperties.registry, new PdfString('Adobe'));\n        systemInfo.items.setValue(this.dictionaryProperties.ordering, new PdfString(this.dictionaryProperties.identity));\n        systemInfo.items.setValue(this.dictionaryProperties.supplement, new PdfNumber(0));\n        return systemInfo;\n    };\n    /**\n     * Runs before font Dictionary will be saved.\n     */\n    UnicodeTrueTypeFont.prototype.descendantFontBeginSave = function () {\n        if (this.usedChars !== null && this.usedChars !== undefined && this.usedChars.size() > 0) {\n            var width = this.getDescendantWidth();\n            if (width !== null) {\n                this.descendantFont.items.setValue(this.dictionaryProperties.w, width);\n            }\n        }\n    };\n    /**\n     * Runs before font Dictionary will be saved.\n     */\n    UnicodeTrueTypeFont.prototype.cmapBeginSave = function () {\n        this.generateCmap();\n    };\n    /**\n     * Runs before font Dictionary will be saved.\n     */\n    /* tslint:disable */\n    UnicodeTrueTypeFont.prototype.fontDictionaryBeginSave = function () {\n        if (this.usedChars !== null && this.usedChars !== undefined && this.usedChars.size() > 0 && !this.fontDictionary.containsKey(this.dictionaryProperties.toUnicode)) {\n            this.fontDictionary.items.setValue(this.dictionaryProperties.toUnicode, new PdfReferenceHolder(this.cmap));\n        }\n    };\n    /* tslint:enable */\n    /**\n     * Runs before font program stream save.\n     */\n    UnicodeTrueTypeFont.prototype.fontProgramBeginSave = function () {\n        this.isCompress = true;\n        this.generateFontProgram();\n    };\n    /**\n     * Gets width description pad array for c i d font.\n     */\n    UnicodeTrueTypeFont.prototype.getDescendantWidth = function () {\n        var array = new PdfArray();\n        if (this.usedChars !== null && this.usedChars !== undefined && this.usedChars.size() > 0) {\n            var glyphInfo = [];\n            // if (!this.isEmbedFont) {\n            var keys = this.usedChars.keys();\n            for (var i = 0; i < keys.length; i++) {\n                var chLen = keys[i];\n                var glyph = this.ttfReader.getGlyph(chLen);\n                if (glyph.empty) {\n                    continue;\n                }\n                glyphInfo.push(glyph);\n            }\n            // } else {\n            //     glyphInfo = this.ttfReader.getAllGlyphs();\n            // }\n            glyphInfo.sort(function (a, b) { return a.index - b.index; });\n            var firstGlyphIndex = 0;\n            var lastGlyphIndex = 0;\n            var firstGlyphIndexWasSet = false;\n            var widthDetails = new PdfArray();\n            // if (!this.isEmbedFont) {\n            for (var i = 0; i < glyphInfo.length; i++) {\n                var glyph = glyphInfo[i];\n                if (!firstGlyphIndexWasSet) {\n                    firstGlyphIndexWasSet = true;\n                    firstGlyphIndex = glyph.index;\n                    lastGlyphIndex = glyph.index - 1;\n                }\n                if ((lastGlyphIndex + 1 !== glyph.index || (i + 1 === glyphInfo.length)) && glyphInfo.length > 1) {\n                    // Add glyph index / width.\n                    array.add(new PdfNumber(firstGlyphIndex));\n                    if (i !== 0) {\n                        array.add(widthDetails);\n                    }\n                    firstGlyphIndex = glyph.index;\n                    widthDetails = new PdfArray();\n                }\n                widthDetails.add(new PdfNumber(glyph.width));\n                if (i + 1 === glyphInfo.length) {\n                    array.add(new PdfNumber(firstGlyphIndex));\n                    array.add(widthDetails);\n                }\n                lastGlyphIndex = glyph.index;\n            }\n            // } else {\n            //     for (let i : number = 0; i < glyphInfo.length; i++) {\n            //         let glyph : TtfGlyphInfo = glyphInfo[i];\n            //         if (!firstGlyphIndexWasSet) {\n            //             firstGlyphIndexWasSet = true;\n            //             lastGlyphIndex = glyph.index - 1;\n            //         }\n            //         firstGlyphIndex = glyph.index;\n            //         if ((lastGlyphIndex + 1 === glyph.index || (i + 1 === glyphInfo.length)) && glyphInfo.length > 1) {\n            //             // Add glyph index / width.\n            //             widthDetails.add(new PdfNumber(glyph.width));\n            //             array.add(new PdfNumber(firstGlyphIndex));\n            //             array.add(widthDetails);\n            //             widthDetails = new PdfArray();\n            //         }\n            //         lastGlyphIndex = glyph.index;\n            //     }\n            // }\n        }\n        return array;\n    };\n    /**\n     * Creates cmap.\n     */\n    UnicodeTrueTypeFont.prototype.generateCmap = function () {\n        if (this.usedChars !== null && this.usedChars !== undefined && this.usedChars.size() > 0) {\n            var glyphChars = this.ttfReader.getGlyphChars(this.usedChars);\n            if (glyphChars.size() > 0) {\n                var keys = glyphChars.keys().sort();\n                // add first and last glyph indexes\n                var first = keys[0];\n                var last = keys[keys.length - 1];\n                var middlePart = this.toHexString(first, false) + this.toHexString(last, false) + Operators.newLine;\n                var builder = '';\n                builder += this.cmapPrefix;\n                builder += middlePart;\n                builder += this.cmapEndCodespaceRange;\n                var nextRange = 0;\n                for (var i = 0; i < keys.length; i++) {\n                    if (nextRange === 0) {\n                        if (i !== 0) {\n                            builder += this.cmapEndRange;\n                        }\n                        nextRange = Math.min(100, keys.length - i);\n                        builder += nextRange;\n                        builder += Operators.whiteSpace;\n                        builder += this.cmapBeginRange;\n                    }\n                    nextRange -= 1;\n                    var key = keys[i];\n                    /* tslint:disable */\n                    builder += this.toHexString(key, true) + this.toHexString(key, true) + this.toHexString(glyphChars.getValue(key), true) + '\\n';\n                    /* tslint:enable */\n                }\n                builder += this.cmapSuffix;\n                this.cmap.clearStream();\n                this.cmap.isFont = true;\n                this.cmap.write(builder);\n            }\n        }\n    };\n    /**\n     * Generates font program.\n     */\n    UnicodeTrueTypeFont.prototype.generateFontProgram = function () {\n        var fontProgram = null;\n        this.usedChars = (this.usedChars === null || this.usedChars === undefined) ? new Dictionary() : this.usedChars;\n        this.ttfReader.setOffset(0);\n        fontProgram = this.ttfReader.readFontProgram(this.usedChars);\n        this.fontProgram.clearStream();\n        this.fontProgram.isFont = true;\n        this.fontProgram.writeBytes(fontProgram);\n    };\n    /**\n     * Calculates flags for the font descriptor.\n     * @private\n     */\n    UnicodeTrueTypeFont.prototype.getDescriptorFlags = function () {\n        var flags = 0;\n        var metrics = this.ttfReader.metrics;\n        if (metrics.isFixedPitch) {\n            flags |= FontDescriptorFlags.FixedPitch;\n        }\n        if (metrics.isSymbol) {\n            flags |= FontDescriptorFlags.Symbolic;\n        }\n        else {\n            flags |= FontDescriptorFlags.Nonsymbolic;\n        }\n        if (metrics.isItalic) {\n            flags |= FontDescriptorFlags.Italic;\n        }\n        if (metrics.isBold) {\n            flags |= FontDescriptorFlags.ForceBold;\n        }\n        return flags;\n    };\n    /**\n     * Calculates BoundBox of the descriptor.\n     * @private\n     */\n    UnicodeTrueTypeFont.prototype.getBoundBox = function () {\n        var rect = this.ttfReader.metrics.fontBox;\n        var width = Math.abs(rect.right - rect.left);\n        var height = Math.abs(rect.top - rect.bottom);\n        var rectangle = new RectangleF(rect.left, rect.bottom, width, height);\n        return rectangle;\n    };\n    /**\n     * Converts integer of decimal system to hex integer.\n     */\n    UnicodeTrueTypeFont.prototype.toHexString = function (n, isCaseChange) {\n        var s = n.toString(16);\n        if (isCaseChange) {\n            s = s.toUpperCase();\n        }\n        return '<0000'.substring(0, 5 - s.length) + s + '>';\n    };\n    /**\n     * Stores used symbols.\n     */\n    UnicodeTrueTypeFont.prototype.setSymbols = function (text) {\n        if (text === null) {\n            throw new Error('Argument Null Exception : text');\n        }\n        if (this.usedChars === null || this.usedChars === undefined) {\n            this.usedChars = new Dictionary();\n        }\n        for (var i = 0; i < text.length; i++) {\n            var ch = text[i];\n            this.usedChars.setValue(ch, String.fromCharCode(0));\n        }\n        // else {\n        //     if (text === null) {\n        //         throw new Error('Argument Null Exception : glyphs');\n        //     }\n        //     if (this.usedChars === null || this.usedChars === undefined) {\n        //             this.usedChars = new Dictionary<string, string>();\n        //     }\n        //     for (let i : number = 0; i < text.length; i++) {\n        //         let glyphIndex : number = text[i];\n        //         let glyph : TtfGlyphInfo =  this.ttfReader.getGlyph(glyphIndex);\n        //         if (!glyph == null) {\n        //             let c : string = glyph.charCode.toLocaleString();\n        //             this.usedChars.setValue(c, String.fromCharCode(0));\n        //         }\n        //     }\n        // }\n        if (this.isEmbedFont === false) {\n            this.getDescendantWidth();\n        }\n    };\n    return UnicodeTrueTypeFont;\n}());\nexport { UnicodeTrueTypeFont };\n"]},"metadata":{},"sourceType":"module"}